<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>PRIME 2026 課題解決ドキュメント</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- シンプルなスタイル定義 -->
  <style>
    :root {
      --primary: #123c72;   /* 濃紺 */
      --accent: #4f6f99;
      --border: #d0d4da;
      --bg-section: #f7f8fb;
      --text-main: #222;
    }

    * {
      box-sizing: border-box;
      font-family: "Meiryo", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      margin: 0;
      padding: 24px;
      background: #eef1f5;
      color: var(--text-main);
    }

    .container {
      max-width: 1080px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      padding: 24px 28px 32px;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      color: var(--primary);
    }

    .subtitle {
      font-size: 13px;
      color: #555;
      margin-bottom: 16px;
    }

    .header-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 12px;
      color: #666;
      margin-bottom: 16px;
    }

    .header-meta span {
      padding: 2px 8px;
      border-radius: 999px;
      background: #f1f3f7;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      color: #fff;
      background: var(--primary);
      margin-bottom: 16px;
    }

    .section {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg-section);
      padding: 16px 18px 14px;
      margin-bottom: 16px;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .section-index {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
    }

    .section-title-main {
      font-size: 14px;
      font-weight: 700;
    }

    .section-title-sub {
      font-size: 11px;
      color: #555;
    }

    .section-grid {
      display: grid;
      grid-template-columns: 1.1fr 1.4fr;
      gap: 12px 16px;
    }

    .field-group {
      margin-bottom: 8px;
    }

    .field-label {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 2px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .field-label span.sub {
      font-weight: 400;
      font-size: 11px;
      color: #777;
    }

    textarea,
    input[type="text"] {
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccd0d6;
      padding: 6px 8px;
      font-size: 12px;
      resize: vertical;
      min-height: 40px;
    }

    textarea:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(18,60,114,0.15);
    }

    .two-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px 16px;
    }

    .helper-text {
      font-size: 11px;
      color: #777;
      margin-top: 2px;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 16px;
      align-items: center;
    }

    .save-status {
      font-size: 11px;
      color: #666;
      margin-right: auto;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-secondary {
      background: #f1f3f7;
      color: #333;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    button:active {
      transform: translateY(1px);
    }

    @media (max-width: 768px) {
      .section-grid,
      .two-cols {
        grid-template-columns: 1fr;
      }
      body {
        padding: 12px;
      }
      .container {
        padding: 16px;
      }
    }
  </style>

  <!-- SheetJS（Excel出力用）CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>PRIME 2026 </h1>
    <div class="subtitle">エンジニアリング課題解決シート（提出版）</div>
    <div class="header-meta">
      <span>エンジニア氏名：<input type="text" id="engineer_name" style="border:none;border-bottom:1px solid #ccc;width:160px;font-size:12px;padding:0 2px;" /></span>
      <span>配属先：<input type="text" id="department" style="border:none;border-bottom:1px solid #ccc;width:140px;font-size:12px;padding:0 2px;" /></span>
      <span>現在の業務内容：<input type="text" id="job_role" style="border:none;border-bottom:1px solid #ccc;width:160px;font-size:12px;padding:0 2px;" /></span>
    </div>
    <div class="badge">PRIME 2026 課題解決ドキュメント</div>

    <!-- ① 課題定義 -->
    <section class="section">
      <div class="section-header">
        <div class="section-index">1</div>
        <div>
          <div class="section-title-main">課題定義 <span style="font-weight:400;">（Problem Definition）</span></div>
          <div class="section-title-sub">何について、どこまでを解決しようとしているのかを明確にする。</div>
        </div>
      </div>
      <div class="section-grid">
        <div>
          <div class="field-group">
            <div class="field-label">課題名 <span class="sub">簡潔なタイトル</span></div>
            <textarea id="background" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">背景 <span class="sub">なぜこの課題に向き合うのか</span></div>
            <textarea id="background" rows="3"></textarea>
          </div>
        </div>
        <div>
          <div class="field-group">
            <div class="field-label">現状（AS-IS）</div>
            <textarea id="current" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">目指す姿（TO-BE）</div>
            <textarea id="tobe" rows="3"></textarea>
          </div>
        </div>
      </div>
    </section>

    <!-- ② 制約条件 -->
    <section class="section">
      <div class="section-header">
        <div class="section-index">2</div>
        <div>
          <div class="section-title-main">制約条件・前提 <span style="font-weight:400;">（Constraints）</span></div>
          <div class="section-title-sub">どのような制約・前提のもとで最適解を構築したかを整理する。</div>
        </div>
      </div>
      <div class="two-cols">
        <div>
          <div class="field-group">
            <div class="field-label">コスト制約</div>
            <textarea id="cost" rows="2"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">納期制約</div>
            <textarea id="delivery" rows="2"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">安全・品質・環境</div>
            <textarea id="quality" rows="2"></textarea>
          </div>
        </div>
        <div>
          <div class="field-group">
            <div class="field-label">利用可能リソース <span class="sub">人員・設備・ツールなど</span></div>
            <textarea id="resources" rows="2"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">ステークホルダー <span class="sub">関係者・影響範囲</span></div>
            <textarea id="stakeholders" rows="2"></textarea>
          </div>
        </div>
      </div>
    </section>

    <!-- ③ 初期設計案 -->
    <section class="section">
      <div class="section-header">
        <div class="section-index">3</div>
        <div>
          <div class="section-title-main">初期設計案 <span style="font-weight:400;">（Initial Solution）</span></div>
          <div class="section-title-sub">複数案を比較し、なぜその案を選んだかを明確にする。</div>
        </div>
      </div>

      <div class="two-cols">
        <div>
          <div class="field-group">
            <div class="field-label">A案 概要</div>
            <textarea id="planA" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">A案 メリット / デメリット</div>
            <textarea id="planAmd" rows="3"></textarea>
          </div>
        </div>
        <div>
          <div class="field-group">
            <div class="field-label">B案 概要</div>
            <textarea id="planB" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">B案 メリット / デメリット</div>
            <textarea id="planBmd" rows="3"></textarea>
          </div>
        </div>
      </div>

      <div class="field-group">
        <div class="field-label">
          最終案と採用理由
          <span class="sub">トレードオフ・判断基準を明示</span>
        </div>
        <textarea id="finalInitial" rows="3"></textarea>
        <div class="helper-text">
          例：コスト＜安全性を優先した理由、短期納期とのバランスなど。
        </div>
      </div>
    </section>

    <!-- ④ 再設計案 -->
    <section class="section">
      <div class="section-header">
        <div class="section-index">4</div>
        <div>
          <div class="section-title-main">再設計案 <span style="font-weight:400;">（Redesign）</span></div>
          <div class="section-title-sub">制約条件が変化したときに、どう再設計するかを示す。</div>
        </div>
      </div>

      <div class="two-cols">
        <div>
          <div class="field-group">
            <div class="field-label">制約条件の変更内容</div>
            <textarea id="change" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">再設計の方針</div>
            <textarea id="redesignPolicy" rows="3"></textarea>
          </div>
        </div>
        <div>
          <div class="field-group">
            <div class="field-label">リスク・トレードオフ</div>
            <textarea id="redesignRisk" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">最終案（再設計後）</div>
            <textarea id="redesignFinal" rows="3"></textarea>
          </div>
        </div>
      </div>
    </section>

    <!-- ⑤ 成長ロードマップ -->
    <section class="section">
      <div class="section-header">
        <div class="section-index">5</div>
        <div>
          <div class="section-title-main">将来の成長方向 <span style="font-weight:400;">（Future Roadmap）</span></div>
          <div class="section-title-sub">今回の課題を通じて見えた、自身の成長方向とアクション。</div>
        </div>
      </div>

      <div class="two-cols">
        <div>
          <div class="field-group">
            <div class="field-label">不足している能力・スキル</div>
            <textarea id="gap" rows="3"></textarea>
          </div>
          <div class="field-group">
            <div class="field-label">今後身につけたい技術・知識</div>
            <textarea id="futureSkills" rows="3"></textarea>
          </div>
        </div>
        <div>
          <div class="field-group">
            <div class="field-label">1〜3年の行動計画</div>
            <textarea id="actions" rows="6"></textarea>
          </div>
        </div>
      </div>
    </section>

    <div class="actions">
      <div id="saveStatus" class="save-status">未保存</div>
      <button class="btn-secondary" type="button" onclick="clearForm()">
        クリア
      </button>
      <button class="btn-secondary" type="button" onclick="manualSave()">
        保存
      </button>
      <button class="btn-primary" type="button" onclick="exportToExcel()">
        Excelに出力（.xlsx）
      </button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "PRIME_2026_PSD_V1";

    const FIELD_IDS = [
      "engineer_name","department","job_role",
      "title","background","current","tobe",
      "cost","delivery","quality","resources","stakeholders",
      "planA","planAmd","planB","planBmd","finalInitial",
      "change","redesignPolicy","redesignRisk","redesignFinal",
      "gap","futureSkills","actions"
    ];

    let saveTimer = null;

    function updateSaveStatus(text) {
      const el = document.getElementById("saveStatus");
      if (!el) return;
      el.textContent = text;
    }

    function getFormData() {
      const data = {};
      FIELD_IDS.forEach(id => {
        const el = document.getElementById(id);
        data[id] = el ? el.value : "";
      });
      return data;
    }

    function setFormData(data) {
      FIELD_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el && Object.prototype.hasOwnProperty.call(data, id)) {
          el.value = data[id];
        }
      });
    }

    function saveToStorage(showTime = true) {
      try {
        const data = getFormData();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        if (showTime) {
          const now = new Date();
          const t = now.toTimeString().slice(0,8);
          updateSaveStatus("自動保存済み " + t);
        } else {
          updateSaveStatus("保存済み");
        }
      } catch (e) {
        console.error("保存に失敗しました", e);
        updateSaveStatus("保存エラー");
      }
    }

    function manualSave() {
      saveToStorage(false);
    }

    function scheduleAutoSave() {
      updateSaveStatus("編集中…");
      if (saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(() => saveToStorage(true), 1500);
    }

    function clearForm() {
      if (!confirm("全ての入力内容をクリアし、保存データも削除します。よろしいですか？")) return;
      FIELD_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = "";
      });
      localStorage.removeItem(STORAGE_KEY);
      updateSaveStatus("未保存");
    }

    function exportToExcel() {
      const v = id => (document.getElementById(id)?.value || "").replace(/\r\n/g, "\n");

      const engineerName = v("engineer_name");
      const department   = v("department");
      const jobRole      = v("job_role");

      const title        = v("title");
      const background   = v("background");
      const current      = v("current");
      const tobe         = v("tobe");

      const cost         = v("cost");
      const delivery     = v("delivery");
      const quality      = v("quality");
      const resources    = v("resources");
      const stakeholders = v("stakeholders");

      const planA        = v("planA");
      const planAmd      = v("planAmd");
      const planB        = v("planB");
      const planBmd      = v("planBmd");
      const finalInitial = v("finalInitial");

      const change       = v("change");
      const redesignPolicy = v("redesignPolicy");
      const redesignRisk = v("redesignRisk");
      const redesignFinal = v("redesignFinal");

      const gap          = v("gap");
      const futureSkills = v("futureSkills");
      const actions      = v("actions");

      const data = [
        ["PRIME 2026 Problem Solving Document"],
        ["エンジニアリング課題解決シート（提出版）"],
        [],
        ["エンジニア氏名", engineerName],
        ["所属", department],
        ["想定職種", jobRole],
        [],
        ["① 課題定義（Problem Definition）"],
        ["課題名", title],
        ["背景", background],
        ["現状（AS-IS）", current],
        ["目指す姿（TO-BE）", tobe],
        [],
        ["② 制約条件・前提（Constraints）"],
        ["コスト制約", cost],
        ["納期制約", delivery],
        ["安全・品質・環境", quality],
        ["利用可能リソース", resources],
        ["ステークホルダー", stakeholders],
        [],
        ["③ 初期設計案（Initial Solution）"],
        ["A案 概要", planA],
        ["A案 メリット/デメリット", planAmd],
        ["B案 概要", planB],
        ["B案 メリット/デメリット", planBmd],
        ["最終案と採用理由（トレードオフ含む）", finalInitial],
        [],
        ["④ 再設計案（Redesign）"],
        ["制約条件の変更内容", change],
        ["再設計の方針", redesignPolicy],
        ["リスク・トレードオフ", redesignRisk],
        ["最終案（再設計後）", redesignFinal],
        [],
        ["⑤ 将来の成長方向（Future Roadmap）"],
        ["不足している能力・スキル", gap],
        ["今後身につけたい技術・知識", futureSkills],
        ["1〜3年の行動計画", actions]
      ];

      const ws = XLSX.utils.aoa_to_sheet(data);
      const wscols = [
        { wch: 28 },
        { wch: 80 }
      ];
      ws["!cols"] = wscols;

      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "PRIME_Doc");

      const safeName = engineerName || "PRIME_Engineer";
      const fileName = `PRIME_2026_Problem_Solving_${safeName}.xlsx`;

      XLSX.writeFile(wb, fileName);
    }

    // 初期化：保存データの読み込み＆入力監視
    window.addEventListener("DOMContentLoaded", () => {
      // 保存されていれば復元
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const data = JSON.parse(raw);
          setFormData(data);
          updateSaveStatus("保存データから復元済み");
        } else {
          updateSaveStatus("未保存");
        }
      } catch (e) {
        console.error("復元に失敗しました", e);
        updateSaveStatus("復元エラー");
      }

      // 自動保存用リスナー
      FIELD_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("input", scheduleAutoSave);
      });
    });
  </script>
</body>

</html>

